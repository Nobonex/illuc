<ng-container *ngIf="workflow as current; else emptyState">
  <section class="workflow-detail">
    <header class="workflow-header">
      <div *ngIf="titleParts() as parts">
        <h2>
          <span *ngIf="parts.taskId" class="task-pill">#{{ parts.taskId }}</span>
          <span>{{ parts.label }}</span>
        </h2>
        <p class="meta">
          Branch: <strong>{{ current.branchName }}</strong> • Worktree:
          <code>{{ current.worktreePath }}</code>
        </p>
      </div>
      <div class="header-actions">
        <div class="workspace-actions">
          <button
            type="button"
            class="ghost icon-btn"
            (click)="onOpenVsCode()"
            title="Open in VS Code"
            aria-label="Open in VS Code"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <polyline points="7 8 3 12 7 16"></polyline>
              <polyline points="17 8 21 12 17 16"></polyline>
              <line x1="14" y1="4" x2="10" y2="20"></line>
            </svg>
          </button>
          <button
            type="button"
            class="ghost icon-btn"
            (click)="onOpenTerminal()"
            title="Open terminal"
            aria-label="Open terminal"
          >
            <svg
              class="icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
              focusable="false"
            >
              <rect x="3" y="5" width="18" height="14" rx="2"></rect>
              <polyline points="7 9 11 12 7 15"></polyline>
              <line x1="12.5" y1="15" x2="17" y2="15"></line>
            </svg>
          </button>
        </div>
        <span class="status-pill" [attr.data-status]="current.status">
          {{ statusLabel() }}
        </span>
        <button
          type="button"
          class="icon-btn"
          (click)="onStart()"
          [disabled]="!canStart()"
          title="Start workflow"
          aria-label="Start workflow"
        >
          ▶
        </button>
        <button
          type="button"
          class="icon-btn"
          (click)="onStop()"
          [disabled]="!isRunning()"
          title="Stop workflow"
          aria-label="Stop workflow"
        >
          ■
        </button>
        <button
          type="button"
          class="warn icon-btn"
          (click)="onDiscard()"
          title="Discard workflow"
          aria-label="Discard workflow"
        >
          <svg
            class="icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
            focusable="false"
          >
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
        </button>
      </div>
    </header>

    <div class="split-panels">
      <div class="terminal-column">
        <app-workflow-terminal [workflowId]="current.workflowId"></app-workflow-terminal>
      </div>
      <div class="diff-column">
        <app-workflow-diff [workflowId]="current.workflowId"></app-workflow-diff>
      </div>
    </div>
  </section>
</ng-container>

<ng-template #emptyState>
  <div class="empty-view">
    <p>Select a workflow to see its terminal and diff.</p>
  </div>
</ng-template>
