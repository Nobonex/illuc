<div class="diff-comment-thread" (click)="$event.stopPropagation()">
    <button
        type="button"
        class="diff-thread-collapse"
        (click)="collapseThread.emit($event)"
        aria-label="Collapse thread"
        title="Collapse thread"
    >
        <svg
            class="diff-thread-collapse-glyph"
            viewBox="0 0 12 16"
            aria-hidden="true"
        >
            <polyline
                points="3,2 6,6 9,2"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
            <polyline
                points="3,14 6,10 9,14"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            />
        </svg>
    </button>
    <div class="diff-comment-thread-inner">
        <div *ngIf="comments.length; else noComments" class="diff-comment-list">
            <div *ngFor="let comment of comments" class="diff-comment">
                <div class="diff-comment-meta">
                    <div class="diff-comment-meta-left">
                        <span class="diff-comment-author">
                            {{ displayNameFor(comment.author) }}
                        </span>
                    </div>
                    <div class="diff-comment-meta-right">
                        <div class="select-wrapper diff-comment-status-wrap">
                            <select
                                class="diff-comment-status"
                                [attr.data-status]="comment.status || 'active'"
                                [ngModelOptions]="{ standalone: true }"
                                [ngModel]="comment.status || 'active'"
                                (ngModelChange)="
                                    onStatusChange(comment, $event)
                                "
                                [disabled]="statusUpdatingIds.has(comment.id)"
                            >
                                <option
                                    *ngFor="let option of reviewStatusOptions"
                                    [ngValue]="option.value"
                                >
                                    {{ option.label }}
                                </option>
                            </select>
                            <span
                                class="select-arrow diff-comment-status-arrow"
                                aria-hidden="true"
                                >âŒ„</span
                            >
                        </div>
                        <span class="diff-comment-time">
                            {{ comment.createdAt | date: "short" }}
                        </span>
                    </div>
                </div>
                <div class="diff-comment-body">
                    <div [innerHTML]="renderCommentBody(comment)"></div>
                </div>
            </div>
        </div>
        <ng-template #noComments>
            <div class="diff-comment-empty">Start a new review thread.</div>
        </ng-template>
        <form
            class="diff-comment-form"
            [class.has-draft]="draft.trim().length > 0"
            (submit)="submitComment.emit($event)"
        >
            <textarea
                class="diff-comment-input"
                rows="3"
                [ngModelOptions]="{ standalone: true }"
                [ngModel]="draft"
                (ngModelChange)="draftChange.emit($event)"
                placeholder="Write a comment.."
            ></textarea>
            <div class="diff-comment-actions">
                <button
                    type="submit"
                    class="diff-comment-submit"
                    [disabled]="!canSubmit"
                    (mousedown)="$event.preventDefault()"
                >
                    Comment
                </button>
            </div>
        </form>
    </div>
</div>
