<aside class="task-sidebar">
    <div class="sidebar-top">
        <div class="repo-card">
            <div class="repo-head">
                <span class="repo-label">Workspace</span>
                <div class="repo-actions" *ngIf="baseRepo">
                    <app-open-vscode-button
                        [path]="baseRepo.canonicalPath"
                        title="Open repository in VS Code"
                        ariaLabel="Open repository in VS Code"
                        buttonClass="repo-action-btn"
                    ></app-open-vscode-button>
                    <app-open-terminal-button
                        [path]="baseRepo.canonicalPath"
                        title="Open repository terminal"
                        ariaLabel="Open repository terminal"
                        buttonClass="repo-action-btn"
                    ></app-open-terminal-button>
                    <app-open-settings-button
                        buttonClass="repo-action-btn"
                    ></app-open-settings-button>
                </div>
            </div>

            <div class="repo-body" *ngIf="baseRepo; else noRepo">
                <a
                    href="#"
                    class="path-link repo-path"
                    (click)="openInExplorer($event, baseRepo.canonicalPath)"
                    [attr.title]="baseRepo.canonicalPath"
                >
                    {{ baseRepo.canonicalPath }}
                </a>
                <div class="repo-meta">
                    <span class="repo-branch">{{ baseRepo.currentBranch }}</span>
                    <span class="repo-meta-sep">Â·</span>
                    <span class="repo-meta-hint">Base repository</span>
                </div>
            </div>

            <ng-template #noRepo>
                <div class="repo-empty">
                    <div class="repo-empty-title">No repository selected</div>
                    <div class="repo-empty-copy">
                        Pick a repo to create and run tasks.
                    </div>
                </div>
            </ng-template>
        </div>

        <button
            type="button"
            class="nav-item"
            [class.selected]="homeSelected"
            (click)="onSelectHome()"
            aria-label="Open time tracking"
        >
            <app-icon-clock-circle></app-icon-clock-circle>
            <span class="nav-label">Time Tracking</span>
        </button>

        <div class="section-head">
            <div class="section-left">
                <span class="section-title">Tasks</span>
                <span class="count-badge">{{ tasks?.length || 0 }}</span>
            </div>
            <button
                type="button"
                class="icon-btn create-btn"
                (click)="createTask.emit()"
                [disabled]="!baseRepo"
                [attr.title]="baseRepo ? 'Create task' : 'Select a repository first'"
                aria-label="Create task"
            >
                <app-icon-plus></app-icon-plus>
            </button>
        </div>
    </div>

    <div class="task-list" *ngIf="tasks?.length; else emptyState">
        <div
            *ngFor="let task of tasks; trackBy: trackById"
            class="task-row"
            [class.selected]="task.taskId === selectedTaskId"
            (click)="onSelect(task.taskId)"
        >
            <div class="row-top" *ngIf="titleParts(task.title) as parts">
                <span class="status-dot" [attr.data-status]="task.status"></span>
                <div class="row-title">
                    <span *ngIf="parts.taskId" class="task-pill"
                        >#{{ parts.taskId }}</span
                    >
                    <span class="title-text">{{ parts.label }}</span>
                </div>
            </div>

            <div class="row-bottom">
                <small class="branch">{{ task.branchName }}</small>
                <div class="row-right">
                    <span class="status" [attr.data-status]="task.status">
                        {{ statusLabel(task.status) }}
                    </span>
                    <div class="actions" aria-label="Task actions">
                        <app-task-action-button
                            type="stop"
                            variant="icon"
                            title="Stop agent"
                            [disabled]="!isRunning(task.status)"
                            [loading]="stopLoadingIds.has(task.taskId)"
                            [stopPropagation]="true"
                            (action)="onStop(task.taskId)"
                        >
                            <app-icon-stop-square></app-icon-stop-square>
                        </app-task-action-button>
                        <app-task-action-button
                            type="discard"
                            variant="icon"
                            title="Discard task"
                            [loading]="discardLoadingIds.has(task.taskId)"
                            [stopPropagation]="true"
                            (action)="onDiscard(task.taskId)"
                        >
                            <app-icon-trash-bin></app-icon-trash-bin>
                        </app-task-action-button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ng-template #emptyState>
        <div class="empty">
            <div class="empty-title">No tasks yet</div>
            <p class="empty-copy">
                Create a task to get started. Tasks appear here once created.
            </p>
        </div>
    </ng-template>
</aside>
