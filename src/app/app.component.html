<div class="app-shell">
  <main class="content">
    <app-task-sidebar
      *ngIf="baseRepo() as repo"
      [tasks]="tasks()"
      [selectedTaskId]="taskStore.selectedTaskId()"
      [baseRepo]="repo"
      (createTask)="openCreateTaskModal()"
      (selectTask)="selectTask($event)"
      (startTask)="startTask($event)"
      (stopTask)="stopTask($event)"
      (discardTask)="discardTask($event)"
    ></app-task-sidebar>

    <app-task-view
      class="task-view"
      [task]="selectedTask()"
      [baseRepo]="baseRepo()"
      (startTask)="startTask($event)"
      (stopTask)="stopTask($event)"
      (discardTask)="discardTask($event)"
      (selectBaseRepo)="browseForRepo()"
    ></app-task-view>
  </main>

  <footer class="status-bar" *ngIf="statusMessage">
    {{ statusMessage }}
  </footer>

  <div class="modal-backdrop" *ngIf="showCreateModal">
    <div class="modal">
      <h3>Create Task</h3>
      <p class="modal-subtitle">Provide the Git branch name for this task.</p>
      <label class="input-label">Branch name</label>
      <input
        type="text"
        [(ngModel)]="branchNameInput"
        placeholder="e.g. feature/25323-fancy-feature-name"
      />
      <label class="input-label">Base branch</label>
      <div class="select-wrapper">
        <select [(ngModel)]="baseBranchSelection">
          <option
            *ngIf="
              baseBranchSelection &&
              branchOptions().indexOf(baseBranchSelection) === -1
            "
            [value]="baseBranchSelection"
          >
            {{ baseBranchSelection }}
          </option>
          <option *ngFor="let branch of branchOptions()" [value]="branch">
            {{ branch }}
          </option>
        </select>
        <span class="select-arrow">âŒ„</span>
      </div>
      <div class="error" *ngIf="branchNameError">{{ branchNameError }}</div>
      <div class="modal-actions">
        <button type="button" class="ghost" (click)="closeCreateTaskModal()">Cancel</button>
        <button type="button" class="primary" (click)="submitNewTask()">Create Task</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="confirmDiscardTaskId">
    <div class="modal">
      <h3>Discard task?</h3>
      <p class="modal-subtitle">
        This will remove the worktree and discard all changes for
        <strong>{{ confirmDiscardTitle }}</strong>
        <span *ngIf="confirmDiscardBranch">({{ confirmDiscardBranch }})</span>. This action cannot be undone.
      </p>
      <div class="error" *ngIf="confirmDiscardError">{{ confirmDiscardError }}</div>
      <div class="modal-actions">
        <button type="button" class="ghost" (click)="cancelDiscardTask()">Cancel</button>
        <button type="button" class="primary warn" (click)="confirmDiscardTask()">Discard</button>
      </div>
    </div>
  </div>
</div>
